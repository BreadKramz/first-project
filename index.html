<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kramz Quiz</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<audio id="bg-music" loop>
  <source src="Jeopardy Theme.mp3" type="audio/mpeg">
</audio>

<div class="container fade-panel">

  <!-- Start Screen -->
  <div class="start-screen show" id="start-screen">
    <h2>üéâ Welcome to the Kramz Quiz!</h2>
    <p style="text-align: center; margin: 10px 0;">Under construction pa guys pero its working</p>
    <button class="start-btn" onclick="startQuiz()">‚ñ∂ Start Quiz</button>
    <button class="settings-btn" onclick="toggleAddQuestion()">‚ûï Add Question</button>
    <button class="settings-btn" onclick="toggleSettings()">‚öôÔ∏è Settings</button>
    <button class="settings-btn" onclick="openFeedbackPanel()">üí¨ Feedback</button>
    <button class="admin-btn" onclick="showAdminLogin()">üë®üèª‚Äçüíº Admin Login</button>
  </div>

  <!-- Feedback Panel -->
  <div class="quiz-container" id="feedback-panel">
    <h2>üí¨ Feedback / Suggestions</h2>
    <textarea id="feedback-text" placeholder="Write your suggestions here..." style="width:100%; height:100px; padding:8px; border-radius:6px; border:1px solid #ccc;"></textarea>
    <button class="start-btn" onclick="submitFeedback()">Submit Feedback</button>
    <button class="start-btn" onclick="backToStart()">Back</button>
    <p id="feedback-message" style="text-align:center; margin-top:10px;"></p>
  </div>

  <!-- Add Question -->
  <div class="add-question-screen" id="add-question-screen">
    <h2>Add Your Own Question</h2>
    <input type="text" id="new-question" placeholder="Enter your question">
    <div id="choices-container">
      <input type="text" class="choice-input" placeholder="Choice 1">
      <input type="text" class="choice-input" placeholder="Choice 2">
      <input type="text" class="choice-input" placeholder="Choice 3">
      <input type="text" class="choice-input" placeholder="Choice 4">
    </div>
    <label for="correct-answer">Correct Answer (1-4):</label>
    <input type="number" id="correct-answer" min="1" max="4">
    <button class="start-btn" onclick="addCustomQuestion()">Add Question</button>
    <button class="start-btn" onclick="backToStart()">Back</button>
    <p id="add-feedback" style="text-align:center; margin-top: 10px;"></p>
  </div>

  <!-- Settings -->
  <div class="settings-screen" id="settings-screen">
    <h2>Settings</h2>
    <label for="num-choices">Number of choices:</label>
    <select id="num-choices">
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4" selected>4</option>
    </select>
    <div class="toggle">
      <label>Background Music:</label>
      <input type="checkbox" id="music-toggle" checked>
    </div>
    <button class="start-btn" onclick="backToStart()">Back</button>
  </div>

  <!-- Quiz -->
  <div class="quiz-container" id="quiz">
    <div id="question-counter">Question 1 of 4</div>
    <div id="timer">Time: 10</div>
    <h2 id="question">Question here...</h2>
    <div class="options" id="options-container"></div>
    <div id="feedback"></div>
    <button id="next-btn" onclick="nextQuestion()">Next</button>
  </div>

  <!-- Score Screen -->
  <div class="quiz-container" id="score-screen">
    <h2 style="text-align:center;" id="score-text">Your Score:</h2>
    <p style="text-align:center; margin: 15px 0; font-weight: bold;" id="score-message"></p>
    <button class="start-btn" onclick="returnToStart()">Try Again</button>
  </div>

  <!-- Admin Login -->
  <div id="admin-login" class="admin-login">
    <h2>Admin Login</h2>
    <input type="text" id="admin-username" placeholder="Username">
    <input type="password" id="admin-password" placeholder="Password">
    <p id="admin-feedback" style="text-align:center; color:red;"></p>
    <button class="admin-btn" onclick="adminLogin()">Login</button>
    <button class="start-btn" onclick="backToStart()">Back</button>
  </div>

  <!-- Admin Panel -->
  <div id="admin-panel" class="admin-screen">
    <h2>Admin Panel</h2>
    <button class="view-questions-btn" onclick="goToViewPanel()">View Saved Questions</button>
    <button class="clear-questions-btn" onclick="goToClearPanel()">Clear Saved Questions</button>
    <button class="view-questions-btn" onclick="viewFeedbacks()">View Feedback</button>
    <button class="start-btn" onclick="backToStart()">Back</button>
  </div>

  <div class="quiz-container" id="feedback-view-panel">
    <h2>üìã All Feedback</h2>
    <div id="feedback-list" style="max-height:200px; overflow-y:auto;"></div>
    <button class="start-btn" onclick="backToAdminPanel()">Back</button>
  </div>

  <!-- View Panel -->
  <div id="view-panel" class="quiz-container">
    <h2>Saved Questions</h2>
    <div id="questions-list-container" style="max-height: 200px; overflow-y: auto;"></div>
    <button class="start-btn" onclick="backToAdminPanel()">Back</button>
  </div>

  <!-- Clear Panel -->
  <div id="clear-panel" class="quiz-container">
    <h2>Clear All Saved Questions</h2>
    <p>Are you sure you want to delete all saved questions?</p>
    <button class="debug-btn" onclick="clearCustomQuestions()">Yes, Clear</button>
    <button class="start-btn" onclick="backToAdminPanel()">Back</button>
  </div>
</div>

<script src="script.js"></script>

<!-- Firebase App (Core SDK) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD0YczZXnEp1Yup8aKpn-tzuaxUMOiDxVE",
    authDomain: "kramzquiz.firebaseapp.com",
    projectId: "kramzquiz",
    storageBucket: "kramzquiz.firebasestorage.app",
    messagingSenderId: "1085936591670",
    appId: "1:1085936591670:web:7070a37f9d6d76ce9d0997"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Save feedback to Firestore
  window.submitFeedback = async function () {
    const text = document.getElementById("feedback-text").value.trim();
    const msg = document.getElementById("feedback-message");

    if (!text) {
      msg.innerText = "‚ö†Ô∏è Please enter your feedback.";
      msg.style.color = "#e53935";
      return;
    }

    try {
      await addDoc(collection(db, "feedback"), {
        message: text,
        date: new Date().toLocaleString()
      });
      msg.innerText = "‚úÖ Thank you for your feedback!";
      msg.style.color = "#4caf50";
      document.getElementById("feedback-text").value = "";
    } catch (error) {
      msg.innerText = "‚ùå Error sending feedback.";
      msg.style.color = "#e53935";
      console.error(error);
    }
  };

  // View all feedback (Admin)
  window.viewFeedbacks = async function () {
    document.getElementById("admin-panel").classList.remove("show");
    document.getElementById("feedback-view-panel").classList.add("show");

    const list = document.getElementById("feedback-list");
    list.innerHTML = "";

    try {
      const querySnapshot = await getDocs(collection(db, "feedback"));
      if (querySnapshot.empty) {
        list.innerHTML = "<p>No feedback yet.</p>";
      } else {
        querySnapshot.forEach((doc, i) => {
          const fb = doc.data();
          const fbDiv = document.createElement("div");
          fbDiv.style.marginBottom = "10px";
          fbDiv.innerHTML = `<strong>Feedback ${i + 1}</strong> (${fb.date}):<br>${fb.message}`;
          list.appendChild(fbDiv);
        });
      }
    } catch (error) {
      list.innerHTML = "<p>‚ùå Error loading feedback.</p>";
      console.error(error);
    }
  };
</script>

</body>
</html>
